<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Advanced Watermark Tool - WebTools</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #3b82f6;
      --secondary: #1e40af;
      --success: #10b981;
      --danger: #ef4444;
      --dark: #1f2937;
      --light: #f9fafb;
      --gray: #9ca3af;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --radius: 12px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
      color: var(--dark);
      min-height: 100vh;
      padding: 20px;
    }

    header {
      background: white;
      border-radius: var(--radius);
      padding: 25px;
      margin-bottom: 30px;
      box-shadow: var(--shadow);
      text-align: center;
    }

    h1 {
      color: var(--secondary);
      margin-bottom: 15px;
      font-size: 2.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }

    nav {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    nav a {
      text-decoration: none;
      color: white;
      background: var(--primary);
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    nav a:hover {
      background: var(--secondary);
      transform: translateY(-2px);
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
    }

    @media (max-width: 992px) {
      .container {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: white;
      border-radius: var(--radius);
      padding: 25px;
      box-shadow: var(--shadow);
      height: fit-content;
    }

    h2 {
      color: var(--primary);
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--primary);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .tool-description {
      grid-column: 1 / -1;
      text-align: center;
      padding: 30px;
    }

    .tool-description p {
      color: var(--gray);
      font-size: 1.1rem;
      margin-top: 10px;
    }

    .upload-area {
      border: 3px dashed var(--gray);
      border-radius: 10px;
      padding: 40px 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      margin-bottom: 20px;
      position: relative;
    }

    .upload-area:hover {
      border-color: var(--primary);
      background: #f8fafc;
    }

    .upload-area i {
      font-size: 3rem;
      color: var(--primary);
      margin-bottom: 15px;
    }

    .preview-container {
      position: relative;
      margin: 20px 0;
      min-height: 300px;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      overflow: hidden;
      background: #f8fafc;
    }

    #preview {
      max-width: 100%;
      max-height: 400px;
      display: block;
      margin: 0 auto;
    }

    #watermarkCanvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    .controls {
      display: grid;
      gap: 20px;
      margin-top: 25px;
    }

    .control-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    label {
      font-weight: 600;
      color: var(--dark);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    input[type="text"],
    input[type="number"],
    input[type="file"],
    select {
      padding: 12px 15px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 16px;
      transition: border 0.3s;
    }

    input[type="text"]:focus,
    input[type="number"]:focus,
    select:focus {
      outline: none;
      border-color: var(--primary);
    }

    .slider-container {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    input[type="range"] {
      flex: 1;
      height: 8px;
      border-radius: 4px;
      background: #e5e7eb;
      outline: none;
      -webkit-appearance: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: var(--primary);
      cursor: pointer;
    }

    .color-picker {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    input[type="color"] {
      width: 60px;
      height: 40px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      padding: 0;
    }

    .btn-group {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      margin-top: 20px;
    }

    button {
      padding: 14px 28px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      flex: 1;
      min-width: 160px;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--secondary);
      transform: translateY(-2px);
    }

    .btn-secondary {
      background: #6b7280;
      color: white;
    }

    .btn-secondary:hover {
      background: #4b5563;
      transform: translateY(-2px);
    }

    .btn-success {
      background: var(--success);
      color: white;
    }

    .btn-success:hover {
      background: #059669;
      transform: translateY(-2px);
    }

    .btn-danger {
      background: var(--danger);
      color: white;
    }

    .btn-danger:hover {
      background: #dc2626;
      transform: translateY(-2px);
    }

    .watermark-preview {
      background: repeating-conic-gradient(#f8fafc 0% 25%, #e5e7eb 0% 50%);
      background-size: 20px 20px;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      font-weight: bold;
      font-size: 1.5rem;
      margin: 15px 0;
      min-height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }

    .logo-upload {
      border: 2px dashed var(--gray);
      padding: 30px;
      text-align: center;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .logo-upload:hover {
      border-color: var(--primary);
      background: #f8fafc;
    }

    .logo-preview {
      max-width: 100px;
      max-height: 100px;
      margin: 10px auto;
      display: none;
    }

    .position-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin: 15px 0;
    }

    .position-btn {
      padding: 12px;
      border: 2px solid #e5e7eb;
      background: white;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 20px;
    }

    .position-btn:hover {
      border-color: var(--primary);
      background: #f0f9ff;
    }

    .position-btn.active {
      border-color: var(--primary);
      background: var(--primary);
      color: white;
    }

    footer {
      text-align: center;
      margin-top: 40px;
      padding: 20px;
      color: var(--gray);
      border-top: 1px solid #e5e7eb;
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 25px;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      transform: translateX(150%);
      transition: transform 0.3s;
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 10px;
      max-width: 400px;
    }

    .notification.show {
      transform: translateX(0);
    }

    .notification.success {
      background: var(--success);
    }

    .notification.error {
      background: var(--danger);
    }

    .notification.info {
      background: var(--primary);
    }

    .loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1001;
    }

    .loading.show {
      display: flex;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 5px solid #f3f3f3;
      border-top: 5px solid var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .media-info {
      background: #f8fafc;
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
      font-size: 0.9rem;
    }

    .advanced-options {
      background: #f8fafc;
      padding: 20px;
      border-radius: 8px;
      margin-top: 20px;
    }

    .toggle-advanced {
      background: none;
      border: none;
      color: var(--primary);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      margin-bottom: 10px;
    }
  </style>
</head>

<body>
  <div class="loading" id="loading">
    <div class="spinner"></div>
  </div>

  <div class="notification" id="notification"></div>

  <header>
    <h1><i class="fas fa-water"></i> Advanced Watermark Tool</h1>
    <nav>
      <a href="../index.html"><i class="fas fa-home"></i> Home</a>
      <a href="splitVideo.html"><i class="fas fa-chevron-left"></i> Previous Tool</a>
      <a href="removeWatermark.html"><i class="fas fa-chevron-right"></i> Next Tool</a>
    </nav>
  </header>

  <section class="tool-description card">
    <h2><i class="fas fa-info-circle"></i> About This Tool</h2>
    <p>Add text or logo watermarks to your images and videos. Protect your content with customizable watermarks that can be positioned anywhere on your media.</p>
  </section>

  <div class="container">
    <!-- Left Column: Media Upload and Preview -->
    <div class="card">
      <h2><i class="fas fa-upload"></i> Upload Media</h2>
      
      <div class="upload-area" id="uploadArea">
        <i class="fas fa-cloud-upload-alt"></i>
        <h3>Drag & Drop or Click to Upload</h3>
        <p>Supported formats: JPG, PNG, GIF, MP4, WebM</p>
        <p>Max file size: 50MB</p>
        <input type="file" id="mediaInput" accept="image/*,video/*" hidden />
      </div>

      <div class="preview-container" id="previewContainer">
        <img id="preview" alt="Media Preview">
        <canvas id="watermarkCanvas"></canvas>
      </div>

      <div class="media-info" id="mediaInfo" style="display: none;">
        <p><strong>File Name:</strong> <span id="fileName"></span></p>
        <p><strong>File Size:</strong> <span id="fileSize"></span></p>
        <p><strong>Dimensions:</strong> <span id="fileDimensions"></span></p>
      </div>

      <div class="btn-group">
        <button class="btn-secondary" onclick="clearMedia()">
          <i class="fas fa-trash"></i> Clear Media
        </button>
        <button class="btn-success" onclick="downloadMedia()" id="downloadBtn" disabled>
          <i class="fas fa-download"></i> Download Result
        </button>
      </div>
    </div>

    <!-- Right Column: Watermark Settings -->
    <div class="card">
      <h2><i class="fas fa-sliders-h"></i> Watermark Settings</h2>

      <div class="controls">
        <div class="control-group">
          <label><i class="fas fa-font"></i> Watermark Type</label>
          <select id="watermarkType" onchange="toggleWatermarkType()">
            <option value="text">Text Watermark</option>
            <option value="logo">Logo Watermark</option>
          </select>
        </div>

        <!-- Text Watermark Settings -->
        <div id="textSettings">
          <div class="control-group">
            <label><i class="fas fa-pen"></i> Watermark Text</label>
            <input type="text" id="watermarkText" placeholder="Enter watermark text" value="© 2024 Your Brand">
          </div>

          <div class="control-group">
            <label><i class="fas fa-palette"></i> Text Color</label>
            <div class="color-picker">
              <input type="color" id="textColor" value="#ffffff">
              <input type="color" id="shadowColor" value="#000000">
              <span>Shadow</span>
            </div>
          </div>

          <div class="control-group">
            <label><i class="fas fa-ruler-combined"></i> Font Size</label>
            <div class="slider-container">
              <span>10px</span>
              <input type="range" id="fontSize" min="10" max="100" value="30">
              <span>100px</span>
              <span id="fontSizeValue">30px</span>
            </div>
          </div>

          <div class="control-group">
            <label><i class="fas fa-eye-slash"></i> Opacity</label>
            <div class="slider-container">
              <span>10%</span>
              <input type="range" id="opacity" min="10" max="100" value="70">
              <span>100%</span>
              <span id="opacityValue">70%</span>
            </div>
          </div>
        </div>

        <!-- Logo Watermark Settings -->
        <div id="logoSettings" style="display: none;">
          <div class="logo-upload" id="logoUpload">
            <i class="fas fa-image"></i>
            <p>Click to upload logo (PNG recommended)</p>
            <input type="file" id="logoInput" accept="image/*" hidden />
          </div>
          <img id="logoPreview" class="logo-preview" alt="Logo Preview">
          
          <div class="control-group">
            <label><i class="fas fa-expand-alt"></i> Logo Size</label>
            <div class="slider-container">
              <span>10%</span>
              <input type="range" id="logoScale" min="5" max="50" value="15">
              <span>50%</span>
              <span id="logoScaleValue">15%</span>
            </div>
          </div>
        </div>

        <!-- Position Settings -->
        <div class="control-group">
          <label><i class="fas fa-arrows-alt"></i> Position</label>
          <div class="position-grid">
            <button class="position-btn" onclick="setPosition('top-left')">↖</button>
            <button class="position-btn" onclick="setPosition('top-center')">↑</button>
            <button class="position-btn" onclick="setPosition('top-right')">↗</button>
            <button class="position-btn" onclick="setPosition('middle-left')">←</button>
            <button class="position-btn active" onclick="setPosition('center')">◎</button>
            <button class="position-btn" onclick="setPosition('middle-right')">→</button>
            <button class="position-btn" onclick="setPosition('bottom-left')">↙</button>
            <button class="position-btn" onclick="setPosition('bottom-center')">↓</button>
            <button class="position-btn" onclick="setPosition('bottom-right')">↘</button>
          </div>
        </div>

        <!-- Advanced Options -->
        <div class="advanced-options">
          <button class="toggle-advanced" onclick="toggleAdvanced()">
            <i class="fas fa-chevron-down"></i> Advanced Options
          </button>
          <div id="advancedSettings" style="display: none;">
            <div class="control-group">
              <label><i class="fas fa-redo"></i> Repeat Pattern</label>
              <select id="repeatPattern">
                <option value="none">Single Watermark</option>
                <option value="diagonal">Diagonal Pattern</option>
                <option value="grid">Grid Pattern</option>
                <option value="full">Full Coverage</option>
              </select>
            </div>

            <div class="control-group">
              <label><i class="fas fa-angle"></i> Rotation</label>
              <div class="slider-container">
                <span>0°</span>
                <input type="range" id="rotation" min="0" max="360" value="0">
                <span>360°</span>
                <span id="rotationValue">0°</span>
              </div>
            </div>

            <div class="control-group">
              <label><i class="fas fa-border-style"></i> Padding</label>
              <div class="slider-container">
                <span>0px</span>
                <input type="range" id="padding" min="0" max="100" value="20">
                <span>100px</span>
                <span id="paddingValue">20px</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Preview Area -->
        <div class="watermark-preview" id="watermarkPreview">
          <span id="previewText">Watermark Preview</span>
          <img id="previewLogo" style="display: none; max-width: 100px;">
        </div>

        <!-- Action Buttons -->
        <div class="btn-group">
          <button class="btn-primary" onclick="applyWatermark()">
            <i class="fas fa-magic"></i> Apply Watermark
          </button>
          <button class="btn-danger" onclick="resetSettings()">
            <i class="fas fa-undo"></i> Reset Settings
          </button>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <p>&copy; 2026 WebTools - Advanced Watermark Tool</p>
    <p>All processing happens in your browser - your files never leave your computer</p>
  </footer>

  <script>
    // ============ Global Variables ============
    let originalMedia = null;
    let mediaType = null; // 'image' or 'video'
    let mediaElement = null;
    let watermarkType = 'text';
    let position = 'center';
    let logoImage = null;
    let canvas = document.getElementById('watermarkCanvas');
    let ctx = canvas.getContext('2d');
    let isAdvancedOpen = false;

    // ============ Initialize ============
    document.addEventListener('DOMContentLoaded', function() {
      initializeEventListeners();
      updateSliderValues();
    });

    function initializeEventListeners() {
      // File upload
      document.getElementById('uploadArea').addEventListener('click', () => {
        document.getElementById('mediaInput').click();
      });

      document.getElementById('mediaInput').addEventListener('change', handleMediaUpload);
      document.getElementById('logoUpload').addEventListener('click', () => {
        document.getElementById('logoInput').click();
      });

      document.getElementById('logoInput').addEventListener('change', handleLogoUpload);

      // Drag and drop
      const uploadArea = document.getElementById('uploadArea');
      uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.style.borderColor = '#3b82f6';
        uploadArea.style.background = '#f0f9ff';
      });

      uploadArea.addEventListener('dragleave', () => {
        uploadArea.style.borderColor = '#9ca3af';
        uploadArea.style.background = 'white';
      });

      uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.style.borderColor = '#9ca3af';
        uploadArea.style.background = 'white';
        
        if (e.dataTransfer.files.length) {
          document.getElementById('mediaInput').files = e.dataTransfer.files;
          handleMediaUpload();
        }
      });

      // Real-time updates
      document.getElementById('watermarkText').addEventListener('input', updatePreview);
      document.getElementById('textColor').addEventListener('input', updatePreview);
      document.getElementById('shadowColor').addEventListener('input', updatePreview);
      document.getElementById('fontSize').addEventListener('input', updatePreview);
      document.getElementById('opacity').addEventListener('input', updatePreview);
      document.getElementById('logoScale').addEventListener('input', updatePreview);
      document.getElementById('rotation').addEventListener('input', updatePreview);
      document.getElementById('padding').addEventListener('input', updatePreview);
      document.getElementById('repeatPattern').addEventListener('change', updatePreview);
    }

    // ============ Media Upload ============
    function handleMediaUpload() {
      const fileInput = document.getElementById('mediaInput');
      if (!fileInput.files.length) return;

      const file = fileInput.files[0];
      const fileSizeMB = (file.size / (1024 * 1024)).toFixed(2);

      if (fileSizeMB > 50) {
        showNotification('File size exceeds 50MB limit!', 'error');
        return;
      }

      showLoading(true);
      
      const reader = new FileReader();
      reader.onload = function(e) {
        originalMedia = e.target.result;
        mediaType = file.type.startsWith('video/') ? 'video' : 'image';
        
        const preview = document.getElementById('preview');
        const previewContainer = document.getElementById('previewContainer');
        
        if (mediaType === 'image') {
          preview.src = originalMedia;
          preview.style.display = 'block';
          preview.onload = function() {
            updateCanvasSize();
            updateMediaInfo(file, preview);
            showLoading(false);
          };
        } else {
          // For videos, we'll use a video element
          const video = document.createElement('video');
          video.src = originalMedia;
          video.controls = true;
          video.style.maxWidth = '100%';
          video.style.maxHeight = '400px';
          
          previewContainer.innerHTML = '';
          previewContainer.appendChild(video);
          previewContainer.appendChild(canvas);
          
          video.onloadedmetadata = function() {
            updateCanvasSize();
            updateMediaInfo(file, video);
            showLoading(false);
          };
        }

        document.getElementById('mediaInfo').style.display = 'block';
        document.getElementById('downloadBtn').disabled = true;
        showNotification('Media uploaded successfully!', 'success');
        updatePreview();
      };

      reader.readAsDataURL(file);
    }

    function handleLogoUpload() {
      const fileInput = document.getElementById('logoInput');
      if (!fileInput.files.length) return;

      const file = fileInput.files[0];
      const reader = new FileReader();
      
      reader.onload = function(e) {
        logoImage = new Image();
        logoImage.src = e.target.result;
        
        logoImage.onload = function() {
          document.getElementById('logoPreview').src = e.target.result;
          document.getElementById('logoPreview').style.display = 'block';
          updatePreview();
          showNotification('Logo uploaded successfully!', 'success');
        };
      };
      
      reader.readAsDataURL(file);
    }

    // ============ Watermark Functions ============
    function applyWatermark() {
      if (!originalMedia) {
        showNotification('Please upload media first!', 'error');
        return;
      }

      showLoading(true);

      // Create a temporary canvas for the final result
      const tempCanvas = document.createElement('canvas');
      const tempCtx = tempCanvas.getContext('2d');
      
      // Set canvas size to match media
      const preview = document.getElementById('preview');
      tempCanvas.width = canvas.width;
      tempCanvas.height = canvas.height;

      // Draw original media
      if (mediaType === 'image') {
        const img = new Image();
        img.src = originalMedia;
        img.onload = function() {
          tempCtx.drawImage(img, 0, 0, tempCanvas.width, tempCanvas.height);
          applyWatermarkToCanvas(tempCtx, tempCanvas);
          finalizeResult(tempCanvas);
        };
      } else {
        const video = document.querySelector('video');
        tempCtx.drawImage(video, 0, 0, tempCanvas.width, tempCanvas.height);
        applyWatermarkToCanvas(tempCtx, tempCanvas);
        finalizeResult(tempCanvas);
      }
    }

    function applyWatermarkToCanvas(context, targetCanvas) {
      const fontSize = parseInt(document.getElementById('fontSize').value);
      const opacity = parseInt(document.getElementById('opacity').value) / 100;
      const rotation = parseInt(document.getElementById('rotation').value);
      const padding = parseInt(document.getElementById('padding').value);
      const repeatPattern = document.getElementById('repeatPattern').value;
      
      context.save();
      context.globalAlpha = opacity;
      
      if (rotation !== 0) {
        context.translate(targetCanvas.width / 2, targetCanvas.height / 2);
        context.rotate(rotation * Math.PI / 180);
        context.translate(-targetCanvas.width / 2, -targetCanvas.height / 2);
      }

      if (watermarkType === 'text') {
        const text = document.getElementById('watermarkText').value || 'Watermark';
        const textColor = document.getElementById('textColor').value;
        const shadowColor = document.getElementById('shadowColor').value;
        
        context.font = `bold ${fontSize}px Arial`;
        context.fillStyle = textColor;
        context.shadowColor = shadowColor;
        context.shadowBlur = 5;
        context.shadowOffsetX = 2;
        context.shadowOffsetY = 2;

        if (repeatPattern === 'none') {
          drawWatermarkAtPosition(context, text, targetCanvas, padding);
        } else {
          drawPattern(context, text, targetCanvas, repeatPattern);
        }
      } else if (watermarkType === 'logo' && logoImage) {
        const scale = parseInt(document.getElementById('logoScale').value) / 100;
        const logoWidth = logoImage.width * scale;
        const logoHeight = logoImage.height * scale;

        if (repeatPattern === 'none') {
          drawLogoAtPosition(context, logoImage, targetCanvas, logoWidth, logoHeight, padding);
        } else {
          drawLogoPattern(context, logoImage, targetCanvas, logoWidth, logoHeight, repeatPattern);
        }
      }

      context.restore();
    }

    function drawWatermarkAtPosition(context, text, canvas, padding) {
      const textWidth = context.measureText(text).width;
      const x = getPositionX(canvas.width, textWidth, padding);
      const y = getPositionY(canvas.height, 50, padding);
      
      context.fillText(text, x, y);
    }

    function drawLogoAtPosition(context, logo, canvas, logoWidth, logoHeight, padding) {
      const x = getPositionX(canvas.width, logoWidth, padding);
      const y = getPositionY(canvas.height, logoHeight, padding);
      
      context.drawImage(logo, x, y, logoWidth, logoHeight);
    }

    function getPositionX(canvasWidth, elementWidth, padding) {
      switch (position) {
        case 'top-left':
        case 'middle-left':
        case 'bottom-left':
          return padding;
        case 'top-center':
        case 'center':
        case 'bottom-center':
          return (canvasWidth - elementWidth) / 2;
        case 'top-right':
        case 'middle-right':
        case 'bottom-right':
          return canvasWidth - elementWidth - padding;
        default:
          return (canvasWidth - elementWidth) / 2;
      }
    }

    function getPositionY(canvasHeight, elementHeight, padding) {
      switch (position) {
        case 'top-left':
        case 'top-center':
        case 'top-right':
          return padding + elementHeight;
        case 'middle-left':
        case 'center':
        case 'middle-right':
          return (canvasHeight + elementHeight) / 2;
        case 'bottom-left':
        case 'bottom-center':
        case 'bottom-right':
          return canvasHeight - padding;
        default:
          return (canvasHeight + elementHeight) / 2;
      }
    }

    function drawPattern(context, text, canvas, pattern) {
      const textWidth = context.measureText(text).width;
      const spacing = 150;

      if (pattern === 'diagonal') {
        for (let i = -canvas.width; i < canvas.width * 2; i += spacing) {
          for (let j = -canvas.height; j < canvas.height * 2; j += spacing) {
            context.save();
            context.translate(i, j);
            context.rotate(45 * Math.PI / 180);
            context.fillText(text, 0, 0);
            context.restore();
          }
        }
      } else if (pattern === 'grid') {
        for (let i = 100; i < canvas.width; i += 200) {
          for (let j = 100; j < canvas.height; j += 100) {
            context.fillText(text, i, j);
          }
        }
      } else if (pattern === 'full') {
        const angle = 30 * Math.PI / 180;
        const xSpacing = 200;
        const ySpacing = 100;

        for (let x = -canvas.width; x < canvas.width * 2; x += xSpacing) {
          for (let y = -canvas.height; y < canvas.height * 2; y += ySpacing) {
            context.save();
            context.translate(x, y);
            context.rotate(angle);
            context.fillText(text, 0, 0);
            context.restore();
          }
        }
      }
    }

    function drawLogoPattern(context, logo, canvas, logoWidth, logoHeight, pattern) {
      const spacing = 200;

      if (pattern === 'diagonal') {
        for (let i = -canvas.width; i < canvas.width * 2; i += spacing) {
          for (let j = -canvas.height; j < canvas.height * 2; j += spacing) {
            context.save();
            context.translate(i, j);
            context.rotate(45 * Math.PI / 180);
            context.drawImage(logo, 0, 0, logoWidth, logoHeight);
            context.restore();
          }
        }
      } else if (pattern === 'grid') {
        for (let i = 100; i < canvas.width; i += 200) {
          for (let j = 100; j < canvas.height; j += 150) {
            context.drawImage(logo, i, j, logoWidth, logoHeight);
          }
        }
      }
    }

    function finalizeResult(tempCanvas) {
      // Update the preview canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(tempCanvas, 0, 0);
      
      // Enable download button
      document.getElementById('downloadBtn').disabled = false;
      
      showLoading(false);
      showNotification('Watermark applied successfully!', 'success');
      
      // Create download link
      tempCanvas.toBlob(function(blob) {
        const downloadUrl = URL.createObjectURL(blob);
        document.getElementById('downloadBtn').onclick = function() {
          downloadResult(downloadUrl);
        };
      });
    }

    function downloadResult(url) {
      const link = document.createElement('a');
      link.href = url;
      link.download = `watermarked-${Date.now()}.${mediaType === 'image' ? 'png' : 'mp4'}`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      showNotification('Download started!', 'success');
    }

    // ============ UI Functions ============
    function updatePreview() {
      const preview = document.getElementById('watermarkPreview');
      const previewText = document.getElementById('previewText');
      const previewLogo = document.getElementById('previewLogo');
      
      if (watermarkType === 'text') {
        previewText.style.display = 'block';
        previewLogo.style.display = 'none';
        
        const fontSize = document.getElementById('fontSize').value;
        const textColor = document.getElementById('textColor').value;
        const opacity = document.getElementById('opacity').value / 100;
        
        previewText.textContent = document.getElementById('watermarkText').value || 'Preview';
        previewText.style.fontSize = `${fontSize}px`;
        previewText.style.color = textColor;
        previewText.style.opacity = opacity;
        
        // Apply shadow
        const shadowColor = document.getElementById('shadowColor').value;
        previewText.style.textShadow = `2px 2px 3px ${shadowColor}`;
      } else {
        previewText.style.display = 'none';
        previewLogo.style.display = 'block';
        
        if (logoImage) {
          const scale = document.getElementById('logoScale').value / 100;
          previewLogo.src = logoImage.src;
          previewLogo.style.maxWidth = `${scale * 100}px`;
          previewLogo.style.opacity = document.getElementById('opacity').value / 100;
        }
      }
      
      // Update canvas preview
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      if (originalMedia) {
        const tempCanvas = document.createElement('canvas');
        const tempCtx = tempCanvas.getContext('2d');
        tempCanvas.width = canvas.width;
        tempCanvas.height = canvas.height;
        applyWatermarkToCanvas(tempCtx, tempCanvas);
        ctx.drawImage(tempCanvas, 0, 0);
      }
      
      updateSliderValues();
    }

    function updateSliderValues() {
      document.getElementById('fontSizeValue').textContent = 
        `${document.getElementById('fontSize').value}px`;
      document.getElementById('opacityValue').textContent = 
        `${document.getElementById('opacity').value}%`;
      document.getElementById('logoScaleValue').textContent = 
        `${document.getElementById('logoScale').value}%`;
      document.getElementById('rotationValue').textContent = 
        `${document.getElementById('rotation').value}°`;
      document.getElementById('paddingValue').textContent = 
        `${document.getElementById('padding').value}px`;
    }

    function updateCanvasSize() {
      const preview = document.getElementById('preview');
      const video = document.querySelector('video');
      
      if (preview && preview.style.display !== 'none') {
        canvas.width = preview.width || preview.naturalWidth;
        canvas.height = preview.height || preview.naturalHeight;
      } else if (video) {
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
      }
      
      canvas.style.width = '100%';
      canvas.style.height = '100%';
    }

    function updateMediaInfo(file, mediaElement) {
      document.getElementById('fileName').textContent = file.name;
      document.getElementById('fileSize').textContent = 
        `${(file.size / (1024 * 1024)).toFixed(2)} MB`;
      
      if (mediaElement.naturalWidth) {
        document.getElementById('fileDimensions').textContent = 
          `${mediaElement.naturalWidth} × ${mediaElement.naturalHeight} px`;
      } else if (mediaElement.videoWidth) {
        document.getElementById('fileDimensions').textContent = 
          `${mediaElement.videoWidth} × ${mediaElement.videoHeight} px`;
      }
    }

    function toggleWatermarkType() {
      watermarkType = document.getElementById('watermarkType').value;
      const textSettings = document.getElementById('textSettings');
      const logoSettings = document.getElementById('logoSettings');
      
      if (watermarkType === 'text') {
        textSettings.style.display = 'block';
        logoSettings.style.display = 'none';
      } else {
        textSettings.style.display = 'none';
        logoSettings.style.display = 'block';
      }
      
      updatePreview();
    }

    function setPosition(pos) {
      position = pos;
      
      // Update active button
      document.querySelectorAll('.position-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');
      
      updatePreview();
    }

    function toggleAdvanced() {
      const advancedSettings = document.getElementById('advancedSettings');
      const toggleIcon = event.target.querySelector('i');
      
      isAdvancedOpen = !isAdvancedOpen;
      
      if (isAdvancedOpen) {
        advancedSettings.style.display = 'block';
        toggleIcon.className = 'fas fa-chevron-up';
      } else {
        advancedSettings.style.display = 'none';
        toggleIcon.className = 'fas fa-chevron-down';
      }
    }

    function clearMedia() {
      originalMedia = null;
      mediaType = null;
      
      document.getElementById('preview').src = '';
      document.getElementById('preview').style.display = 'none';
      document.getElementById('mediaInfo').style.display = 'none';
      document.getElementById('mediaInput').value = '';
      document.getElementById('downloadBtn').disabled = true;
      
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      const previewContainer = document.getElementById('previewContainer');
      const video = previewContainer.querySelector('video');
      if (video) video.remove();
      
      showNotification('Media cleared', 'info');
    }

    function resetSettings() {
      document.getElementById('watermarkText').value = '© 2024 Your Brand';
      document.getElementById('textColor').value = '#ffffff';
      document.getElementById('shadowColor').value = '#000000';
      document.getElementById('fontSize').value = 30;
      document.getElementById('opacity').value = 70;
      document.getElementById('logoScale').value = 15;
      document.getElementById('rotation').value = 0;
      document.getElementById('padding').value = 20;
      document.getElementById('repeatPattern').value = 'none';
      
      document.querySelectorAll('.position-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      document.querySelector('.position-btn[onclick*="center"]').classList.add('active');
      position = 'center';
      
      updatePreview();
      showNotification('Settings reset to defaults', 'info');
    }

    // ============ Utility Functions ============
    function showNotification(message, type) {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.className = `notification ${type} show`;
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    function showLoading(show) {
      document.getElementById('loading').style.display = show ? 'flex' : 'none';
    }
  </script>
</body>
</html>
